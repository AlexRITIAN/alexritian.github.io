<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>k8sæ‰“æ€ªå‡çº§ä¹‹è·¯---ç¬¬ä¸€å…³ï¼Œæ­å»ºä¸€ä¸ªç®€å•çš„ | Note My Life</title>
<meta name="description" content="éšä¾¿å†™å†™ï¼Œèƒ¡ä¹±è®°è®°" />
<link rel="shortcut icon" href="https://alexritian.github.io/favicon.ico">
<link rel="stylesheet" href="https://alexritian.github.io/styles/main.css">

<script src="https://alexritian.github.io/media/js/jquery.min.js"></script>
<script src="https://alexritian.github.io/media/js/masonry.pkgd.min.js"></script>
<script src="https://alexritian.github.io/media/js/aos.js"></script>
<script src="https://alexritian.github.io/media/js/pace.min.js"></script>
<script src="https://alexritian.github.io/media/js/view-image.min.js"></script>
<script src="https://alexritian.github.io/media/js/jquery.magnific-popup.min.js"></script>
<script src="https://alexritian.github.io/media/js/functions.js"></script>
    <meta name="referrer" content="never">
    <meta name="description" content="ä½¿ç”¨kubeadmæ­å»ºä¸€ä¸ªç®€å•çš„k8sé›†ç¾¤

å‡†å¤‡é˜¶æ®µ
è§„åˆ’èŠ‚ç‚¹
å‡†å¤‡linuxæœåŠ¡å™¨ï¼ˆé…ç½®éšæ„ï¼Œä¸èƒ½å°äº2C/2G ğŸ˜œï¼‰ï¼Œè§„åˆ’å“ªäº›æœåŠ¡å™¨ä½œä¸ºmasterèŠ‚ç‚¹ï¼Œé‚£äº›ä½œä¸ºnodeèŠ‚ç‚¹ã€‚
æˆ‘å‡†å¤‡äº†4å°æœåŠ¡å™¨,ä¸€å°ä½œä¸ºmasterèŠ‚ç‚¹ï¼Œ2å°ä½œä¸º..." />
    <meta name="keywords" content="k8s" />
    <script src="https://alexritian.github.io/media/js/waterfall.min.js"></script>
    <script src="https://alexritian.github.io/media/js/prism.min.js"></script>
  </head>
  <body>
            <header id="header" class="grid-container">
        <!-- start: .menu-wrapper -->
        <div class="menu-mobile"> 
          <i class="fa fa-reorder"></i>
        </div>
        <div class="menu-wrapper">
          <div class="">
            <div class="logo">
              <a href="https://alexritian.github.io"><img src="/media/images/custom-headerLogo.jpeg" alt=""></a>
            </div>
            <!-- start: .main-nav -->

            <nav class="main-nav grid-container grid-parent">
              <ul id="menu-header" class="menu gradient-effect">
                <li class=""><a href="https://alexritian.github.io" class="menu">é¦–é¡µ</a></li>
                
                  <li class="" >
                    <a href="/" class="menu">
                      é¦–é¡µ
                    </a>
                  </li>
                
                  <li class="" >
                    <a href="/archives" class="menu">
                      å½’æ¡£
                    </a>
                  </li>
                
                  <li class="" >
                    <a href="/tags" class="menu">
                      æ ‡ç­¾
                    </a>
                  </li>
                
                  <li class="" >
                    <a href="/post/about" class="menu">
                      å…³äº
                    </a>
                  </li>
                
                <li class="search-menu-item hide-on-mobile hide-on-tablet"><a href="#search-lightbox" class="lightbox mfp-inline"><i class="fa fa-search-line"></i></a></li>
              </ul>
            </nav>
            <a href="#search-lightbox" class="lightbox epcl-search-button mfp-inline hide-on-tablet hide-on-desktop"><i class="fa fa-search-line"></i></a>
            <!-- end: .main-nav -->
            <div class="clear"></div>
            <div class="border hide-on-tablet hide-on-mobile"></div>
          </div>    
          <div class="clear"></div>
        </div>
        <!-- end: .menu-wrapper -->
        <div class="clear"></div>
      </header>
      <div class="hide-on-mobile hide-on-tablet hide-on-desktop">
        <div id="search-lightbox" class="grid-container grid-small grid-parent mfp-hide">
          <div class="search-wrapper section">
            <form id="gridea-search-form" data-update="1676619208643" action="/search/index.html" class="search-form" _lpchecked="1">
              <input type="text" name="q" id="s" value="" class="search-field" placeholder="æœç‚¹å•¥..." aria-label="æœç‚¹å•¥..." required="">
              <button type="submit" class="submit" aria-label="Submit">
                <i class="fa fa-search-line"></i>
              </button>
            </form>
          </div>
        </div>
      </div>

      <main id="single" class="main grid-container fullcover no-sidebar aos-init aos-animate" data-aos="fade">

        <div class="center content">
          <div class="featured-image cover" style="background-image: url('https://alexritian.github.io/post-images/k8s-da-guai-sheng-ji-zhi-lu-di-yi-guan-da-jian-yi-ge-jian-dan-de.png');">
            <div class="meta top"> 
              <time class="meta-info" style="float:left;" datetime="2022-11-07"><i class="fa fa-calendar"></i><span class="lately">3 ä¸ªæœˆå‰</span></time>
              
            </div>
            <div class="info">
              <div class="tags ">
                
                      <a href="https://alexritian.github.io/tag/qUEJ3D9at/" class="ctag ctag-0 ctag-qUEJ3D9at" aria-label="">k8s</a>
                    
              </div>
              <h1 class="title ularge white bold">k8sæ‰“æ€ªå‡çº§ä¹‹è·¯---ç¬¬ä¸€å…³ï¼Œæ­å»ºä¸€ä¸ªç®€å•çš„</h1>
            </div>
          </div>
        </div>  

        <div class="epcl-page-wrapper">
          <div class="left-content grid-70 np-mobile">
            <article class="main-article post">
              <section class="post-content">
                <div class="text">
                  <p>ä½¿ç”¨kubeadmæ­å»ºä¸€ä¸ªç®€å•çš„k8sé›†ç¾¤</p>
<!-- more -->
<h1 id="å‡†å¤‡é˜¶æ®µ">å‡†å¤‡é˜¶æ®µ</h1>
<h2 id="è§„åˆ’èŠ‚ç‚¹">è§„åˆ’èŠ‚ç‚¹</h2>
<p>å‡†å¤‡linuxæœåŠ¡å™¨ï¼ˆé…ç½®éšæ„ï¼Œä¸èƒ½å°äº2C/2G ğŸ˜œï¼‰ï¼Œè§„åˆ’å“ªäº›æœåŠ¡å™¨ä½œä¸ºmasterèŠ‚ç‚¹ï¼Œé‚£äº›ä½œä¸ºnodeèŠ‚ç‚¹ã€‚<br>
æˆ‘å‡†å¤‡äº†4å°æœåŠ¡å™¨,ä¸€å°ä½œä¸ºmasterèŠ‚ç‚¹ï¼Œ2å°ä½œä¸ºnodeèŠ‚ç‚¹,æœ‰ä¸€å°ä¸åŠ å…¥é›†ç¾¤çš„æœåŠ¡å™¨ä½œä¸ºéƒ¨ç½²èŠ‚ç‚¹ã€‚</p>
<blockquote>
<p>[!tip]<br>
éƒ¨ç½²èŠ‚ç‚¹ä¸æ˜¯å¿…é¡»çš„ï¼Œé›†ç¾¤ä¸­çš„ä»»ä½•èŠ‚ç‚¹éƒ½å¯ä»¥æ‰§è¡Œéƒ¨ç½²æ“ä½œ</p>
</blockquote>
<h3 id="èŠ‚ç‚¹åå­—å¯é€‰">èŠ‚ç‚¹åå­—(å¯é€‰)</h3>
<p>ç»™æ¯ä¸ªèŠ‚ç‚¹èµ·åå­—ï¼Œç„¶åå°†å…¶é…ç½®åˆ°æ¯ä¸ªæœåŠ¡å™¨çš„ <code>/etc/hosts</code></p>
<blockquote>
<p>[!tip]<br>
é»˜è®¤Podä¸ä¼šè°ƒåº¦åˆ°masterèŠ‚ç‚¹ï¼Œåªä¼šåœ¨nodeèŠ‚ç‚¹è°ƒåº¦</p>
</blockquote>
<h2 id="ä¸‹è½½å®‰è£…åŒ…">ä¸‹è½½å®‰è£…åŒ…</h2>
<h3 id="containerd">containerd</h3>
<ul>
<li><a href="https://github.com/containerd/containerd/releases">containerd-releases</a> :<br>
ä»githubç°åœ¨æœ€æ–°releaseç‰ˆæœ¬</li>
<li><a href="https://github.com/containerd/containerd/blob/main/containerd.service">containerd.service</a> æ–‡ä»¶</li>
<li><a href="https://github.com/containerd/containerd/blob/main/go.mod">go.mod</a></li>
</ul>
<h3 id="runc">runc</h3>
<ul>
<li><a href="https://github.com/opencontainers/runc/releases">runc-releases</a></li>
</ul>
<h3 id="cni-plugin">cni-plugin</h3>
<ul>
<li><a href="https://github.com/containernetworking/plugins/releases">plugins-releases</a></li>
<li><a href="https://github.com/containerd/containerd/blob/main/script/setup/install-cni">åˆå§‹åŒ–è„šæœ¬</a></li>
</ul>
<h3 id="cilium">cilium</h3>
<ul>
<li><a href="https://github.com/cilium/cilium-cli/releases/">releases</a></li>
</ul>
<h3 id="hlem">hlem</h3>
<ul>
<li><a href="https://github.com/helm/helm/releases">releases</a></li>
</ul>
<h3 id="go">go</h3>
<ul>
<li><a href="https://go.dev/dl/go1.19.1.linux-amd64.tar.gz">Download</a></li>
</ul>
<h3 id="k9s">k9s</h3>
<ul>
<li><a href="https://github.com/derailed/k9s/releases">release</a></li>
</ul>
<h2 id="å®‰è£…ç»„ä»¶">å®‰è£…ç»„ä»¶</h2>
<p><em><strong>æ‰€æœ‰èŠ‚ç‚¹ï¼ˆæœåŠ¡å™¨ï¼‰éƒ½éœ€è¦è¿›è¡Œä¸‹åˆ—æ“ä½œ</strong></em></p>
<blockquote>
<p>[!tip]<br>
æœ‰æ¡ä»¶çš„ä½¿ç”¨ <code>root</code> ç”¨æˆ·è¿›è¡Œä¸‹åˆ—æ“ä½œï¼Œérootç”¨æˆ·ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåªæ˜¯æˆ‘æ˜¯ä½¿ç”¨rootè¿›è¡Œçš„æ“ä½œ</p>
</blockquote>
<h3 id="install-go">install go</h3>
<ol>
<li><code>rm -rf /usr/local/go &amp;&amp; tar -C /usr/local -xzf go1.19.1.linux-amd64.tar.gz</code></li>
<li>æ·»åŠ <code>export PATH=$PATH:/usr/local/go/bin</code>åˆ°<code>/etc/profile</code></li>
<li><code>source /etc/profile</code></li>
<li><code>go version</code></li>
</ol>
<p>æ‰§è¡Œä¸‹åˆ—å‘½ä»¤</p>
<pre><code class="language-sh">rm -rf /usr/local/go &amp;&amp; tar -C /usr/local -xzf go1.19.1.linux-amd64.tar.gz
</code></pre>
<p>é…ç½®ç¯å¢ƒå˜é‡ï¼Œæ·»åŠ ä¸‹åˆ—å†…å®¹åˆ° <code>/etc/profile</code></p>
<pre><code>export PATH=$PATH:/usr/local/go/bin
</code></pre>
<p>æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ</p>
<pre><code class="language-sh">source /etc/profile
</code></pre>
<p>éªŒè¯</p>
<pre><code class="language-sh">go version
</code></pre>
<h3 id="install-go-mod">install go mod</h3>
<blockquote>
<p>[!attention]<br>
æˆ‘ä¸æ‡‚GOï¼Œæ‰€ä»¥containerd go modæˆ‘æ˜¯ç›´æ¥ä»githubä¸‹è½½æ–‡ä»¶æ”¾åˆ°äº†goçš„ç›®å½•ä¸­ ğŸ˜…</p>
</blockquote>
<pre><code class="language-sh">mkdir -p /usr/local/go/bin/src/github.com/containerd/containerd/
cp go.mod /usr/local/go/bin/src/github.com/containerd/containerd/
</code></pre>
<h3 id="install-containerd">install containerd</h3>
<p>è§£å‹[[#containerd|å‡†å¤‡é˜¶æ®µ]] ä¸‹è½½çš„ <code>containerd-x.x.x-llinux-amd64.tar.gz</code> è§£å‹åˆ° <code>/usr/local</code> ç›®å½•</p>
<pre><code class="language-sh">tar Cxzvf /usr/local containerd-1.6.8-linux-amd64.tar.gz
</code></pre>
<h3 id="install-runc">install runc</h3>
<p>é€šè¿‡ä¸‹åˆ—å‘½ä»¤å°†[[#runc#|å‡†å¤‡é˜¶æ®µ]] ä¸‹è½½çš„<code>runc.&lt;ARCH&gt;</code> å®‰è£…åˆ°<code>/user/sbin/</code> ç›®å½•</p>
<pre><code class="language-sh">install -m 755 runc.amd64 /usr/sbin/runc
</code></pre>
<h3 id="install-cni-plugin">install CNI plugin</h3>
<p>é€šè¿‡ä¸‹åˆ—å‘½ä»¤å°†[[#cni-plugin|å‡†å¤‡é˜¶æ®µ]] ä¸‹è½½çš„ <code>cni-plugins-xxx-xxx-vxxxx.tgz</code> è§£å‹åˆ° <code>/opt/cni/bin</code> ç›®å½•</p>
<pre><code class="language-sh">mkdir -p /opt/cni/bin
tar Cxzvf /opt/cni/bin cni-plugins-linux-amd64-v1.1.1.tgz
</code></pre>
<h3 id="install-kubeadm-kubelet-å’Œ-kubectl">install kubeadmã€kubelet å’Œ kubectl</h3>
<pre><code class="language-sh">cat &lt;&lt;EOF | sudo tee /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-\$basearch
enabled=1
gpgcheck=1
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
exclude=kubelet kubeadm kubectl
EOF

sudo setenforce 0
sudo sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config

sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes

sudo systemctl enable --now kubelet
</code></pre>
<h2 id="è¿›è¡Œé…ç½®">è¿›è¡Œé…ç½®</h2>
<h3 id="å…³é—­swap">å…³é—­swap</h3>
<p>ç¼–è¾‘ <code>/etc/fstab</code> æ³¨é‡Š swap è¡Œ</p>
<h3 id="é…ç½®iptables">é…ç½®iptables</h3>
<pre><code class="language-sh">cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf
overlay
br_netfilter
EOF

sudo modprobe overlay
sudo modprobe br_netfilter

# è®¾ç½®æ‰€éœ€çš„ sysctl å‚æ•°ï¼Œå‚æ•°åœ¨é‡æ–°å¯åŠ¨åä¿æŒä¸å˜
cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-iptables  = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.ipv4.ip_forward                 = 1
EOF

# åº”ç”¨ sysctl å‚æ•°è€Œä¸é‡æ–°å¯åŠ¨
sudo sysctl --system
</code></pre>
<h3 id="é…ç½®containerdservice">é…ç½®containerd.service</h3>
<p>å°†[[#å‡†å¤‡é˜¶æ®µ#containerd#|å‡†å¤‡é˜¶æ®µ]] ä¸‹è½½çš„<code>containerd.service</code>æ–‡ä»¶å¤åˆ¶åˆ°<code>/usr/lib/systemd/system/</code>ï¼Œç„¶åæ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼š</p>
<pre><code class="language-sh">systemctl daemon-reload
systemctl enable --now containerd
</code></pre>
<h3 id="é…ç½®containerd">é…ç½®containerd</h3>
<h4 id="é…ç½®containerdservice-2">é…ç½®containerd.service</h4>
<p>å°†[[#å‡†å¤‡é˜¶æ®µ#containerd#|å‡†å¤‡é˜¶æ®µ]] ä¸‹è½½çš„<code>containerd.service</code>æ–‡ä»¶å¤åˆ¶åˆ°<code>/usr/lib/systemd/system/</code>ï¼Œç„¶åæ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼š</p>
<pre><code class="language-sh">systemctl daemon-reload
systemctl enable --now containerd
</code></pre>
<p>é€šè¿‡ä¸‹é¢å‘½ä»¤ç”Ÿæˆcontainerdé»˜è®¤é…ç½®æ–‡ä»¶</p>
<pre><code class="language-sh">containerd config default &gt; /etc/containerd/config.toml
</code></pre>
<blockquote>
<p>[!tip]<br>
é‡åˆ°<code>no such file or directory: /etc/containerd/config.toml</code>æŠ¥é”™ï¼Œé€šè¿‡ä¸‹åˆ—å‘½ä»¤åˆ›å»ºç›®å½•</p>
<pre><code class="language-sh">mkdir -p /etc/containerd/
</code></pre>
<p>é‡åˆ°<code>command not found: containerd</code>,æŸ¥è¯¢ <code>containerd</code>ä½ç½®</p>
<pre><code class="language-sh">whereis containerd
</code></pre>
<p>ç»“æœè¾“å‡º<code>containerd: /usr/local/bin/containerd</code>ï¼Œå°†è¾“å‡ºç›®å½•æ·»åŠ åˆ°<code>$PATH</code></p>
</blockquote>
<h4 id="é…ç½®å›½å†…é•œåƒæº">é…ç½®å›½å†…é•œåƒæº</h4>
<p>ä¿®æ”¹ <code>/etc/containerd/config.toml</code> æ–‡ä»¶</p>
<p>ä¿®æ”¹sandbox_imageçš„é•œåƒ</p>
<pre><code>[plugins.&quot;io.containerd.grpc.v1.cri&quot;]
    sandbox_image = &quot;registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.6&quot;
</code></pre>
<p>ä¿®æ”¹registryçš„é•œåƒæº</p>
<pre><code>[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;docker.io&quot;]
    endpoint = [&quot;https://xxxxxx.mirror.aliyuncs.com&quot;, &quot;https://registry-1.docker.io&quot;]
[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;k8s.gcr.io&quot;] 
    endpoint = [&quot;registry.aliyuncs.com/google_containers&quot;]
</code></pre>
<blockquote>
<p>[!tip]<br>
xxxx.mirror.aliyuncs.com éœ€è¦åˆ°é˜¿é‡Œäº‘æ³¨å†Œè·å–ï¼Œæ¯ä¸ªå¸å·æœ‰ä¸€ä¸ªç‹¬ç«‹çš„åœ°å€ã€‚</p>
</blockquote>
<h4 id="é…ç½®-systemd-cgroup-é©±åŠ¨">é…ç½®Â <code>systemd</code>Â cgroup é©±åŠ¨</h4>
<p>åœ¨Â <code>/etc/containerd/config.toml</code>Â ä¸­è®¾ç½® <code>SystemdCgroup</code> ä¸º <strong>true</strong></p>
<pre><code>[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options]
    SystemdCgroup = true
</code></pre>
<h4 id="é‡å¯-congtainerdservice">é‡å¯ congtainerd.service</h4>
<pre><code class="language-sh">sudo systemctl restart containerd
</code></pre>
<h3 id="åˆå§‹åŒ–cni">åˆå§‹åŒ–CNI</h3>
<p>æ‰§è¡Œ[[#cni-plugin|å‡†å¤‡é˜¶æ®µ]] ä¸‹è½½çš„åˆå§‹åŒ–cniçš„è„šæœ¬</p>
<h1 id="å¯åŠ¨é˜¶æ®µ">å¯åŠ¨é˜¶æ®µ</h1>
<h2 id="masterèŠ‚ç‚¹">masterèŠ‚ç‚¹</h2>
<h3 id="åˆå§‹åŒ–é›†ç¾¤">åˆå§‹åŒ–é›†ç¾¤</h3>
<blockquote>
<p>[!tip]<br>
å¦‚æœè§„åˆ’çš„masterèŠ‚ç‚¹æœ‰å¤šä¸ªï¼Œåªéœ€è¦åœ¨ç¬¬ä¸€ä¸ªmasterèŠ‚ç‚¹è¿›è¡Œåˆå§‹åŒ–</p>
</blockquote>
<p>é€šè¿‡ä¸‹åˆ—å‘½ä»¤åˆå§‹åŒ–èŠ‚ç‚¹</p>
<pre><code class="language-sh">kubeadm init \
--control-plane-endpoint=&lt;domain name&gt; \
--image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers \
--token= &lt;token&gt; \
--token-ttl=0 \
--apiserver-advertise-address=&lt;master ip&gt; \
--pod-network-cidr=10.0.0.0/16 \
--node-name=master
</code></pre>
<blockquote>
<p>[!note]<br>
<code>--control-plane-endopoint</code> : é…ç½®control planeçš„åŸŸåï¼Œå¦‚æœæ²¡æœ‰é…ç½®dnsï¼Œéœ€è¦åœ¨æ¯ä¸ªæœåŠ¡å™¨ä¸Šé…ç½® <code>/etc/hosts</code><br>
<code>--image-repository</code> : é•œåƒæºåœ°å€ï¼Œæˆ‘ä½¿ç”¨çš„é˜¿é‡Œäº‘çš„æº<br>
<code>--token</code> ï¼šé…ç½®é›†ç¾¤çš„tokenï¼Œå…¶ä»–èŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„æ—¶å€™ä½¿ç”¨, æ ¼å¼ï¼š &quot;[a-z0-9]{6}.[a-z0-9]{16}&quot;  ä¸ä½¿ç”¨æ­¤å‚æ•°ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª<br>
<code>--token-ttl</code> : tokenè¿‡æœŸæ—¶é—´ï¼ˆä¾‹å¦‚ 1 sï¼Œ2 mï¼Œ3 hï¼‰ï¼Œé»˜è®¤ä¸º 24h0m0sã€‚å¦‚æœè®¾ç½®ä¸º '0'ï¼Œåˆ™ä»¤ç‰Œå°†æ°¸ä¸è¿‡æœŸã€‚<br>
<code>--apiserver-advertise-address</code> :  master èŠ‚ç‚¹çš„IPåœ°å€<br>
<code>--pod-nwework-cidr</code> è¿™ä¸ªæ˜¯é…ç½®é›†ç¾¤å†…éƒ¨ä½¿ç”¨çš„ç½‘æ®µ<br>
<code>--node-name</code> èŠ‚ç‚¹çš„åå­—(å¯ä»¥ä¸æ·»åŠ æ­¤å‚æ•°ï¼Œé»˜è®¤ä¸ºæœåŠ¡å™¨çš„hostname)</p>
</blockquote>
<p>å‘½ä»¤æ‰§è¡ŒæˆåŠŸä¹‹åä¼šæœ‰å¦‚ä¸‹è¾“å‡º</p>
<pre><code>Your Kubernetes control-plane has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config

Alternatively, if you are the root user, you can run:

  export KUBECONFIG=/etc/kubernetes/admin.conf

You should now deploy a pod network to the cluster.
Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

You can now join any number of control-plane nodes by copying certificate authorities
and service account keys on each node and then running the following as root:

  kubeadm join &lt;domain name&gt;:6443 --token &lt;token&gt; \
	--discovery-token-ca-cert-hash &lt;hash&gt; \
	--control-plane 

Then you can join any number of worker nodes by running the following on each as root:

kubeadm join &lt;domain name&gt;:6443 --token &lt;token&gt; \
	--discovery-token-ca-cert-hash &lt;sh256&gt;
</code></pre>
<blockquote>
<p>[!tip]<br>
è¾“å‡ºä¸­çš„<strong>jion</strong>å‘½ä»¤ï¼Œå¸¦æœ‰ <code>--control-plane</code> å‚æ•°çš„æ˜¯æ·»åŠ masterèŠ‚ç‚¹(ç®¡ç†èŠ‚ç‚¹)åˆ°é›†ç¾¤ä¸­ï¼Œå¦ä¸€ä¸ªä¸ºæ·»åŠ nodeèŠ‚ç‚¹(workèŠ‚ç‚¹)åˆ°é›†ç¾¤ä¸­ã€‚</p>
</blockquote>
<h3 id="ç”Ÿæˆcluster-configæ–‡ä»¶">ç”Ÿæˆcluster configæ–‡ä»¶</h3>
<pre><code class="language-sh">mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
</code></pre>
<h2 id="nodeèŠ‚ç‚¹">nodeèŠ‚ç‚¹</h2>
<p>é€šè¿‡ä¸‹åˆ—å‘½ä»¤æŠŠnodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤</p>
<pre><code class="language-sh">kubeadm join \
&lt;master domin name&gt;:6443 \
--token &lt;token&gt; \
--discovery-token-ca-cert-hash &lt;hash256&gt; \
--node-name=node1
</code></pre>
<blockquote>
<p>[!tip]<br>
<code>&lt;master domain name&gt;</code> : åˆå§‹åŒ–é›†ç¾¤çš„æ—¶å€™é…ç½®çš„ <code>--control-plane-endopoint</code> å‚æ•°çš„å€¼<br>
<code>--token</code> : åˆå§‹åŒ–é›†ç¾¤é…ç½®çš„tokenï¼Œç›´æ¥å¤åˆ¶åˆå§‹åŒ–é›†ç¾¤ä¹‹åçš„è¾“å‡ºå†…å®¹ä¸­çš„ tokenä½¿ç”¨å³å¯<br>
<code>--discovery-token-ca-cert-hash</code> : ç›´æ¥å¤åˆ¶åˆå§‹åŒ–é›†ç¾¤ä¹‹åçš„è¾“å‡ºå†…å®¹ä¸­çš„ hashä½¿ç”¨å³å¯<br>
<code>--node-name</code> : èŠ‚ç‚¹çš„åå­—(å¯ä»¥ä¸æ·»åŠ æ­¤å‚æ•°ï¼Œé»˜è®¤ä¸ºæœåŠ¡å™¨çš„hostname)</p>
</blockquote>
<h1 id="é…ç½®éƒ¨ç½²èŠ‚ç‚¹">é…ç½®éƒ¨ç½²èŠ‚ç‚¹</h1>
<h2 id="copy-cluster-configæ–‡ä»¶åˆ°éƒ¨ç½²èŠ‚ç‚¹">copy cluster configæ–‡ä»¶åˆ°éƒ¨ç½²èŠ‚ç‚¹</h2>
<pre><code class="language-sh">mkdir -p $HOME/.kube
cp config $HOME/.kube/
</code></pre>
<blockquote>
<p>[!tipe]<br>
configæ–‡ä»¶æ¥è‡ªmasterèŠ‚ç‚¹ï¼Œç›®å½•åœ¨æ‰§è¡Œåˆå§‹åŒ–é›†ç¾¤æ“ä½œçš„ç”¨æˆ·çš„ <code>$HOME/.kube/</code> ç›®å½•<br>
å¦‚æœé€‰æ‹©åœ¨æ‰§è¡Œåˆå§‹åŒ–é›†ç¾¤å‘½ä»¤çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œéƒ¨ç½²æ“ä½œï¼Œå¯ä»¥è·³è¿‡è¿™æ­¥ã€‚<br>
å¦‚æœé€‰æ‹©åœ¨å…¶ä»–èŠ‚ç‚¹çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œéƒ¨ç½²æ“ä½œï¼Œéœ€è¦æ‰§è¡Œæ­¤æ­¥</p>
</blockquote>
<h2 id="install-kubectl">install kubectl</h2>
<p>å‚è€ƒ [[#install kubeadmã€kubelet å’Œ kubectl|å®‰è£…ç»„ä»¶]] å®‰è£…kubectl</p>
<h2 id="install-helm">install helm</h2>
<pre><code class="language-sh">tar -zxvf helm-v3.0.0-linux-amd64.tar.gz
mv linux-amd64/helm /usr/local/bin/helm
</code></pre>
<blockquote>
<p>[!tip]<br>
æœ‰äº›è™šæœºå¯èƒ½æ²¡æœ‰å°† <code>/usr/local/bin</code> ç›®å½•åŠ å…¥åˆ° <code>$PATH</code></p>
</blockquote>
<h2 id="install-k9s">install k9s</h2>
<ol>
<li>è§£å‹</li>
<li>copy k9s to /usr/local/bin</li>
</ol>
<h1 id="éƒ¨ç½²åº”ç”¨">éƒ¨ç½²åº”ç”¨</h1>
<h2 id="ç½‘ç»œç»„ä»¶">ç½‘ç»œç»„ä»¶</h2>
<h3 id="install-cilium">install cilium</h3>
<pre><code class="language-sh">sudo tar xzvfC cilium-linux-${CLI_ARCH}.tar.gz /usr/local/bin
cilium install
</code></pre>
<p>æŸ¥çœ‹ä¸€ä¸‹çŠ¶æ€</p>
<pre><code class="language-sh">cilium status
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://alexritian.github.io/post-images/1667801122358.png" alt="" loading="lazy"></figure>
<h2 id="æµ‹è¯•ç”¨ä¾‹">æµ‹è¯•ç”¨ä¾‹</h2>
<h3 id="éƒ¨ç½²busybox">éƒ¨ç½²busybox</h3>
<p>åˆ›å»ºä¸€ä¸ª <code>busybox.yaml</code> æ–‡ä»¶,å°†ä¸‹åˆ—å†…å®¹å†™å…¥æ–‡ä»¶ä¸­</p>
<pre><code class="language-yaml">apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: busybox
  labels:
    app: guestbook
    tier: busybox
spec:
  replicas: 2
  selector:
    matchLabels:
      tier: busybox
  template:
    metadata:
      labels:
        tier: busybox
    spec:
      containers:
      - name: busybox
        image: busybox:1.28
        command:
          - sleep
          - &quot;3600&quot;
        imagePullPolicy: IfNotPresent
      restartPolicy: Always

</code></pre>
<p>æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼Œéƒ¨ç½²busyboxåˆ°é›†ç¾¤ä¸­</p>
<pre><code class="language-sh">kubectl apply -f busybox.yaml
</code></pre>
<h1 id="æ£€æŸ¥é›†ç¾¤çŠ¶æ€">æ£€æŸ¥é›†ç¾¤çŠ¶æ€</h1>
<p>é€šè¿‡<strong>k9s</strong>æŸ¥çœ‹å¹¶æµ‹è¯•é›†ç¾¤</p>
<p>æ‰§è¡Œå‘½ä»¤ï¼Œè¿›å…¥k9sç•Œé¢ã€‚</p>
<pre><code class="language-sh">k9s
</code></pre>
<h2 id="æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€">æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</h2>
<p>æŒ‰ <code>ESC</code>,ç„¶å æŒ‰ <code>ï¼š</code>ï¼Œç„¶åè¾“å…¥ <code>node</code>, ç„¶åæŒ‰ <code>Enter</code>ã€‚  ç„¶åçœ‹çœ‹ <code>STATUS</code> åˆ—æ˜¯å¦éƒ½æ˜¯ <code>Ready</code>ã€‚</p>
<figure data-type="image" tabindex="2"><img src="https://alexritian.github.io/post-images/1667801331436.png" alt="" loading="lazy"></figure>
<h2 id="æŸ¥çœ‹-podçŠ¶æ€">æŸ¥çœ‹ PodçŠ¶æ€</h2>
<p>è¿›å…¥k9sä¹‹åï¼ŒæŒ‰<code>ï¼š</code>ï¼Œç„¶åè¾“å…¥ <code>pods</code>,ç„¶åæŒ‰ <code>enter</code> ï¼Œ ç„¶åæŒ‰ <code>0</code>,å°±å¯ä»¥çœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„å†…å®¹. æŸ¥çœ‹ <code>READY</code> å’Œ <code>STATUS</code> æ˜¯å¦æ­£å¸¸ã€‚</p>
<blockquote>
<p>[!info]<br>
k9sçš„è¯¦ç»†æ“ä½œï¼Œå¯ä»¥å‚è€ƒ<a href="https://k9scli.io/">å®˜ç½‘</a>.</p>
</blockquote>
<figure data-type="image" tabindex="3"><img src="https://alexritian.github.io/post-images/1667801528966.png" alt="" loading="lazy"></figure>
<h2 id="æ£€æŸ¥é›†ç¾¤å†…éƒ¨ç½‘ç»œ">æ£€æŸ¥é›†ç¾¤å†…éƒ¨ç½‘ç»œ</h2>
<p>é€šè¿‡æ–¹å‘é”®é€‰ä¸­ <code>busybox</code> çš„podï¼ŒNAMEä»¥ <code>busybox</code>å¼€å¤´ã€‚ç„¶åæŒ‰ <code>S</code> è¿›å…¥pod shellã€‚ (éœ€è¦æå‰è®°å½•ä¸€ä¸‹å¦ä¸€ä¸ª busyboxçš„ IP)</p>
<blockquote>
<p>[!tip]<br>
<code>IP</code> åˆ—å±•ç¤ºçš„æ˜¯Podåœ¨é›†ç¾¤å†…éƒ¨çš„IPåœ°å€</p>
</blockquote>
<pre><code class="language-sh">ping 10.0.0.44 -c 4
</code></pre>
<pre><code>PING 10.0.0.44 (10.0.0.44): 56 data bytes
64 bytes from 10.0.0.44: seq=0 ttl=63 time=0.974 ms
64 bytes from 10.0.0.44: seq=1 ttl=63 time=0.684 ms
64 bytes from 10.0.0.44: seq=2 ttl=63 time=0.702 ms
64 bytes from 10.0.0.44: seq=3 ttl=63 time=0.659 ms

--- 10.0.0.44 ping statistics ---
4 packets transmitted, 4 packets received, 0% packet loss

</code></pre>
<h1 id="æå®š"><em><strong>æå®š</strong></em></h1>
<!-- more -->

                </div>
                <div class="clear"></div>
              </section>
            </article>
            <div class="clear"></div>

            <section class="related section">
              
              <article class="prev grid-50 tablet-grid-50 grid-parent">
                <div class="thumb cover lazy loaded" style="background-image: url('https://alexritian.github.io/post-images/java12-java17-xin-te-xing.png');"></div>
                 <a href="https://alexritian.github.io/post/java12-java17-xin-te-xing/" class="full-link"></a>
                 <div class="info">
                  <time datetime="2022-11-08">2022-11-08</time>
                  <h4 class="title white no-margin">Java12-Java17æ–°ç‰¹æ€§</h4>
                </div>
                 <span class="epcl-button red">
                  <img src="https://alexritian.github.io/media/images/left-arrow.svg" width="15" alt="Left Arrow">
                </span>
                <div class="overlay"></div>
              </article>
              
              

                <div class="clear"></div>
            </section>

              <div class="clear"></div>
              
            
              <div id="comments" class="bg-white hosted ">
                <p>è¯·åˆ°å®¢æˆ·ç«¯â€œä¸»é¢˜--è‡ªå®šä¹‰é…ç½®--valineâ€ä¸­å¡«å…¥IDå’ŒKEY</p>
              </div>
              <div class="clear"></div>
            

            </div>
          </div>
      </main>

          <footer id="footer" class="grid-container">
        <div class="widgets row gradient-effect">
            <div class="default-sidebar border-effect">
              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="tag_cloud-2" class="widget widget_epcl_posts_thumbs underline-effect">
                  <h4 class="widget-title title white bordered">æœ€æ–°æ–‡ç« </h4>
                  
                  
                  <article class="item post-0 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="https://alexritian.github.io/post/rasa-chu-ti-yan-gou-jian-yi-ge-ren-gong-zhi-zhang/" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('https://alexritian.github.io/post-images/rasa-chu-ti-yan-gou-jian-yi-ge-ren-gong-zhi-zhang.jpeg');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="2023-02-17">2023-02-17</time>
                      <h4 class="title usmall">
                        <a href="https://alexritian.github.io/post/rasa-chu-ti-yan-gou-jian-yi-ge-ren-gong-zhi-zhang/">RASAåˆä½“éªŒ---æ„å»ºä¸€ä¸ªäººå·¥æ™ºéšœ</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  <article class="item post-1 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="https://alexritian.github.io/post/shi-yong-docker-qi-dong-tansorflow/" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('https://alexritian.github.io/post-images/shi-yong-docker-qi-dong-tansorflow.png');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="2023-02-14">2023-02-14</time>
                      <h4 class="title usmall">
                        <a href="https://alexritian.github.io/post/shi-yong-docker-qi-dong-tansorflow/">ä½¿ç”¨Dockerå¯åŠ¨TansorFlow</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  <article class="item post-2 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="https://alexritian.github.io/post/da-jian-jian-dan-de-openstack-ti-yan-huan-jing/" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('https://alexritian.github.io/post-images/da-jian-jian-dan-de-openstack-ti-yan-huan-jing.png');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="2023-02-01">2023-02-01</time>
                      <h4 class="title usmall">
                        <a href="https://alexritian.github.io/post/da-jian-jian-dan-de-openstack-ti-yan-huan-jing/">æ­å»ºç®€å•çš„openstackä½“éªŒç¯å¢ƒ</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  <div class="clear"></div>
                </section>
              </div>

              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="tag_cloud-2" class="widget widget_tag_cloud underline-effect">
                  <h4 class="widget-title title white bordered">æ ‡ç­¾äº‘</h4>
                  <div class="tagcloud">
                    
                      <a href="https://alexritian.github.io/tag/-Vhn_CHS9/" class="ctag ctag-0 ctag--Vhn_CHS9" aria-label="">rasa</a>
                    
                      <a href="https://alexritian.github.io/tag/4kwS6SyHpm/" class="ctag ctag-1 ctag-4kwS6SyHpm" aria-label="">chatbot</a>
                    
                      <a href="https://alexritian.github.io/tag/NZso5ulAf/" class="ctag ctag-2 ctag-NZso5ulAf" aria-label="">ai</a>
                    
                      <a href="https://alexritian.github.io/tag/P_RFhSqfsX/" class="ctag ctag-3 ctag-P_RFhSqfsX" aria-label="">tansorflow</a>
                    
                      <a href="https://alexritian.github.io/tag/cW0xTd3xwm/" class="ctag ctag-4 ctag-cW0xTd3xwm" aria-label="">docker</a>
                    
                      <a href="https://alexritian.github.io/tag/BeCMZQC7X/" class="ctag ctag-5 ctag-BeCMZQC7X" aria-label="">openstack</a>
                    
                      <a href="https://alexritian.github.io/tag/XeOQWp44KJ/" class="ctag ctag-6 ctag-XeOQWp44KJ" aria-label="">linux</a>
                    
                      <a href="https://alexritian.github.io/tag/qUEJ3D9at/" class="ctag ctag-7 ctag-qUEJ3D9at" aria-label="">k8s</a>
                    
                      <a href="https://alexritian.github.io/tag/ZVIZwxZ2r/" class="ctag ctag-8 ctag-ZVIZwxZ2r" aria-label="">ubuntu</a>
                    
                      <a href="https://alexritian.github.io/tag/0EAfXnwKzj/" class="ctag ctag-9 ctag-0EAfXnwKzj" aria-label="">chrome</a>
                    
                  </div>
                  <div class="clear"></div>
                </section>
              </div>

              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="epcl_about-2" class="widget widget_epcl_about underline-effect">
                  <h4 class="widget-title title white bordered">å…³äºæˆ‘</h4>
                  <div class="avatar">
                    <a href="" class="translate-effect thumb"><span class="fullimage cover" style="background-image: url(https://alexritian.github.io/images/avatar.png);"></span></a>
                  </div>
                  <div class="info">
                    <h4 class="title small author-name gradient-effect no-margin"><a href="">Note My Life</a></h4>
                    <p class="founder">éšä¾¿å†™å†™ï¼Œèƒ¡ä¹±è®°è®°</p>
                    <div class="social">
                      
                        
                      
                        
                      
                        
                      
                        
                      
                        
                      
                    </div> 
                  </div>
                  <div class="clear"></div>
                  </section>
              </div>

            </div>
            <div class="clear"></div>
        </div>

        <div class="logo">
          <a href="https://alexritian.github.io"><img src="/media/images/custom-footerLogo.jpeg" alt=""></a>
        </div>
        <p class="published border-effect">
          Â©2019 å…± 10 ç¯‡æ–‡ç« 
          <br/>
          Theme <a href="https://gridea.dev/" target="_blank">ã€Œbreekã€</a> Powered by <a href="https://gridea.dev/" target="_blank">ã€ŒGrideaã€</a>
        </p>
        
        <a href="javascript:void(0)" id="back-to-top" class="epcl-button dark" style="display:none">
          <i class="fa fa-arrow"></i>
        </a>
    </footer>
    
    <div class="clear"></div>

        

      
    <script src="https://alexritian.github.io/media/js/functions-post.js"></script>

    </div>
    <!-- end: #wrapper -->
  </body>
</html>
